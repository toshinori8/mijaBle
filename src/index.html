<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />

    <title>Pokoje</title>
  </head>
  <body>
    <style>
      .modal-blur {
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      .modal-fade {
        -webkit-animation: fadein 0.5s;
        animation: fadein 0.5s;
      }

      @-webkit-keyframes fadein {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadein {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .slide-left {
        /* Przesunięcie elementu w lewo o 100px */
        transform: translateX(-100px);
        /* Animacja przesunięcia trwająca 0.5s */
        transition: transform 0.5s;
      }

      .slide-right {
        /* Przesunięcie elementu w prawo o 100px */
        transform: translateX(100px);
        /* Animacja przesunięcia trwająca 0.5s */
        transition: transform 0.5s;
      }

      .room.slide-left {
        transform: translateX(-100px);
        transition: transform 0.5s;
      }

      .room.slide-right {
        transform: translateX(100px);
        transition: transform 0.5s;
      }
    </style>

    <!-- główny ekran-->
    <div class="container mt-5">
      <div class="row">
        <div class="col-12">
          <h1>Lista pokojów</h1>
          <p class="lead">
            Przeciągnij w prawo lub w lewo, aby potwierdzić usunięcie pokoju lub
            wejść w ustawienia
          </p>
          <button class="btn btn-primary float-right" id="addRoomBtn">
            Dodaj pokój
          </button>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12">
          <div class="list-group" id="roomList">
            <!-- Tutaj będą wyświetlane pokoje pobieane z JSON-->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal z formularzem dodawania pokoju -->
    <div class="modal modal-blur modal-fade" tabindex="-1" id="addRoomModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Dodaj pokój</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="roomNameInput">Nazwa pokoju</label>
                <input type="text" class="form-control" id="roomNameInput" />
              </div>
              <div class="form-group">
                <label for="roomMacInput">Adres MAC</label>
                <select class="form-control roomMacInput" id="roomMacInput" ></select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Anuluj
            </button>
            <button type="button" class="btn btn-primary" id="saveRoomBtn">
              Zapisz
            </button>
          </div>
        </div>
      </div>
    </div>

   

    <!-- Modal Edycja pokoju -->
    <div
      class="modal modal-blur modal-fade"
      id="editRoomModal"
      tabindex="-1"
      aria-labelledby="editModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Edytuj pokój</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="editRoomNameInput">Nazwa pokoju</label>
                <input
                  type="text"
                  class="form-control"
                  id="editRoomNameInput"
                  placeholder="Nazwa pokoju"
                />
              </div>
              <div class="form-group">
                <label for="editRoomMacInput">Adres MAC</label>
                <!-- Lista z adresami MAC -->
                <select class="form-control roomMacInput" id="editRoomMacInput" >
                  <!-- Wypełnione z JSON -->
                </select>
              </div>
              <div class="form-group">
                <!-- Pole do edycji adresu MAC -->
                <input
                  type="text"
                  class="form-control"
                  id="editRoomMacInputCustom"
                  placeholder="Wprowadź adres MAC"
                />
              </div>
              <!-- Przycisk zapisania zmian -->
              <!-- <button type="submit" class="btn btn-primary">Zapisz</button> -->
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning del_room">usuń pokój</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
            <button type="button" class="btn btn-primary">Zapisz zmiany</button>

          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
    ></script>

    <script>
      function swipedetect(el, callback) {
        var touchsurface = el,
          swipedir,
          startX,
          startY,
          distX,
          distY,
          threshold = 150, //required min distance traveled to be considered swipe
          restraint = 100, // maximum distance allowed at the same time in perpendicular direction
          allowedTime = 300, // maximum time allowed to travel that distance
          elapsedTime,
          startTime,
          handleswipe = callback || function (swipedir) {};

        touchsurface.addEventListener(
          "touchstart",
          function (e) {
            var touchobj = e.changedTouches[0];
            swipedir = "none";
            dist = 0;
            startX = touchobj.pageX;
            startY = touchobj.pageY;
            startTime = new Date().getTime(); // record time when finger first makes contact with surface
            e.preventDefault();
          },
          false
        );

        touchsurface.addEventListener(
          "touchmove",
          function (e) {
            e.preventDefault(); // prevent scrolling when inside DIV
          },
          false
        );

        touchsurface.addEventListener(
          "touchend",
          function (e) {
            var touchobj = e.changedTouches[0];
            distX = touchobj.pageX - startX; // get horizontal dist traveled by finger while in contact with surface
            distY = touchobj.pageY - startY; // get vertical dist traveled by finger while in contact with surface
            elapsedTime = new Date().getTime() - startTime; // get time elapsed
            if (elapsedTime <= allowedTime) {
              // first condition for awipe met
              if (
                Math.abs(distX) >= threshold &&
                Math.abs(distY) <= restraint
              ) {
                // 2nd condition for horizontal swipe met
                swipedir = distX < 0 ? "left" : "right"; // if dist traveled is negative, it indicates left swipe
                console.log(distX);
              } else if (
                Math.abs(distY) >= threshold &&
                Math.abs(distX) <= restraint
              ) {
                // 2nd condition for vertical swipe met
                swipedir = distY < 0 ? "up" : "down"; // if dist traveled is negative, it indicates up swipe
              }
            }
            handleswipe(swipedir);
            e.preventDefault();
          },
          false
        );
      }

      document.querySelectorAll(".room").forEach(function (room) {
        swipedetect(room, function (swipedir) {
          // swipedir contains either "none", "left", "right", "top", or "down"
          if (swipedir == "left") alert("You just swiped left!");
        });
      });

      // Inicjalizacja SWIPE

      function addTouchSwipeAction(element) {
        // Obsługa zdarzenia touchend

        swipedetect(element, function (swipedir) {
          // swipedir contains either "none", "left", "right", "top", or "down"
          // if (swipedir =='left')

          // alert('You just swiped left!')

          if (swipedir == "right") 
          element.classList.add("slide-right");
          
          if (swipedir == "none") $("#editRoomModal").modal("show");

          const roomMac = element.querySelector(".room-mac").textContent;
          const roomName = element.querySelector(".room-name").textContent;
          document.getElementById("editRoomNameInput").value = roomName;
          document.getElementById("editRoomMacInput").value = roomMac;

          document.getElementById(
            "editRoomMacInput"
          ).value = element.querySelector(".room-mac").textContent;
          document.getElementById(
            "editRoomNameInput"
          ).value = element.querySelector(".room-name").textContent;
        });
        element.addEventListener("transitionend", () => {
          //   Usunięcie klas po zakończeniu animacji przesunięcia
          setTimeout(() => {
            element.classList.remove("slide-left", "slide-right");
          }, 500);
        });

       
      }

      const roomElements = document.querySelectorAll(".room");
     
      roomElements.forEach((roomElement) => {
        addTouchSwipeAction(roomElement);
      });

      // Po kliknięciu przycisku "Dodaj pokój" pokaż modal z formularzem dodawania pokoju
      $("#addRoomBtn").click(function () {
        $("#addRoomModal").modal("show");
      });

      // Po kliknięciu przycisku "Zapisz" w formularzu dodawania pokoju dodaj pokój do listy
      $("#saveRoomBtn").click(function () {
        // Pobierz dane z formularza
        let roomName = $("#roomNameInput").val();
        let roomMac = $("#roomMacInput").val();

        // Dodaj pokój do listy
        addRoom({ name: roomName, mac: roomMac });

        // Wyczyść formularz i zamknij modal
        $("#roomNameInput").val("");
        $("#roomMacInput").val("");
        $("#addRoomModal").modal("hide");
      });

      function addRoom(room) {
        // Dodanie elementu do listy pokoi
        const roomList = document.querySelector("#roomList");
        const newRoomElement = document.createElement("div");
        newRoomElement.innerHTML = `<a href="#" class="room list-group-item list-group-item-action flex-column align-items-start">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1 room-name">${room.name}</h5>
                                        <small class="text-muted room-mac">${room.mac}</small>
                                    </div>
                                    </a>`;

        addTouchSwipeAction(newRoomElement);

        roomList.appendChild(newRoomElement);
      }

      // Przykładowy obiekt z danymi o pokojach
      const rooms = [
        {
          name: "Pokój 1",
          mac: "00:11:22:33:44:55",
        },
        {
          name: "Pokój 2",
          mac: "66:77:88:99:AA:BB",
        },
        {
          name: "Pokój 3",
          mac: "CC:DD:EE:FF:00:11",
        },
      ];

      rooms.forEach((room) => {
         addRoom(room);
      });

      const devices = [
        {
          name: "Czujnik waleria",
          mac: "00:11:22:33:44:55",
        },
        {
          name: "Czujnik kuchnia",
          mac: "66:77:88:99:AA:BB",
        },
        {
          name: "Czujnik łazienka",
          mac: "CC:DD:EE:FF:00:11",
        },
      ];

      // Pobierz elemenry które mają zawierać listę MAC
      const select = document.querySelectorAll("select.roomMacInput");
          console.log(select);
        select.forEach((select) => {
          devices.forEach((device) => {
            const option = document.createElement("option");
            option.value = device.mac;
            option.textContent = device.name;
            select.appendChild(option);
          });
        });

    </script>
  </body>
</html>
